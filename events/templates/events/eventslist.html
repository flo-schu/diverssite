{% extends "page/base_generic.html" %}
{% block content %}

<style>
.d-flex.w-100.justify-content-between{
 background-color: inherit;
 border-bottom: 1px solid gray;
}
.fixed-bottom{
  margin-bottom: 50px;
}

.container-fluid{
  padding-bottom: 50px;
}
</style>


{% for post in posts %}
<div class="container-fluid pb-0">
  <h3>{{ post.title }}</h3>
  <p>{{ post.text }}</p>
</div><!--/span-->
{% endfor %}
<div class="container-fluid pb-2">
  <span class="badge badge-warning" type="button" onclick="window.location.href='{% url 'events:category' 'training' %}';">training</span>
  <span class="badge badge-success" type="button" onclick="window.location.href='{% url 'events:category' 'tournament' %}';">tournaments</span>
  <span class="badge badge-primary" type="button" onclick="window.location.href='{% url 'events:category' 'social' %}';">social</span>
  <span class="badge badge-secondary" type="button" onclick="window.location.href='{% url 'events:category' 'other' %}';">other</span>
</div>

<form action="{% url 'events:index' %}" method="post" name="participation">
  {% csrf_token %}
  <div class="container-fluid">
    <div class="fixed-bottom d-flex">
      <button class="btn btn-primary w-50 rounded-0" type="submit">save</button>
      <a class="btn btn-primary w-50 rounded-0" type="button" name="button" href="{% url 'admin:events_event_add' %}">
        add an event
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="16"></line>
          <line x1="8" y1="12" x2="16" y2="12"></line>
        </svg>
      </a>
    </div>
    <div class="accordion" id="eventslist">
      {% for event, content in events.items %}
      <div class="card">
        <div class="card-header" id="{{event}}_heading">
          <a class="mb-0 d-flex">
            <div class="p-1 w-50">
              {{content.event.name}}
              {% if content.event.category == "training" %}
              <span class="badge badge-warning" type="button" onclick="window.location.href='{% url 'events:category' content.event.categ.slug %}';">{{content.event.category}}</span>
              {% elif content.event.category == "tournament" %}
              <span class="badge badge-success" type="button" onclick="window.location.href='{% url 'events:category' content.event.categ.slug %}';">{{content.event.category}}</span>
              {% elif content.event.category == "social" %}
              <span class="badge badge-primary" type="button" onclick="window.location.href='{% url 'events:category' content.event.categ.slug %}';">{{content.event.category}}</span>
              {% else %}
              <span class="badge badge-secondary" type="button" onclick="window.location.href='{% url 'events:category' content.event.categ.slug %}';">{{content.event.category}}</span>
              {% endif %}
              <br>
              <small>
                {{content.event.date}}
              </small>
            </div>
            <div class="">
              <span class="badge badge-primary badge-pill p-1 flex-shrink-1"> {{content.participation_count}} </span>
            </div>
            <div class="btn-group btn-group-toggle p-1 ml-auto" data-toggle="buttons">
              {% for choice_short, choice in content.choices.items %}
              <label class="btn btn-secondary">
                {% if choice.userchoice == choice.choicetext %}
                <input type="radio" name="evlist_{{user}}_{{content.event.id}}"
                id="{{choice.choice}}" value="{{choice_short}}" checked> {{choice.choicetext}}
                {% else %}
                <input type="radio" name="evlist_{{user}}_{{content.event.id}}"
                id="{{choice.choice}}" value="{{choice_short}}"> {{choice.choicetext}}
                {% endif %}
              </label>
              {% endfor %}
            </div>
            <small class="p-1">
              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#list-{{event}}" aria-expanded="false" aria-controls="{{event}}">
                details
              </button>
            </small>
          <a>
        </div>

        <div class="collapse" id="list-{{event}}" aria-labelledby="{{event}}_heading" data-parent="#eventslist">
          <div class="card-body">
            <div class="d-flex w-100 justify-content-between">
              <small>
                {{content.event.location.name}},
                {{content.event.location.street}},
                {{content.event.location.place}}
              </small>
              <p class="mt-2">
                {{content.event.description}}
              </p>
              {% if user.is_staff %}
              <a class="btn btn-light" role="button" href="{% url 'admin:events_event_change' content.event.id %}?next={{request.path}}">
                edit event
              </a>
              {% endif %}
            </div>

            {% if user.is_authenticated %}
            <div class="">
              <p>
              Yes:
              {% for participant in content.participation_yes %}
              {{participant.person}}
              {% endfor %}
              </p>
              <p>
              No:
              {% for participant in content.participation_no %}
              {{participant.person}}
              {% endfor %}
              </p>
              <p>
              Maybe:
              {% for participant in content.participation_maybe %}
              {{participant.person}}
              {% endfor %}
              </p>

            </div>
          </div>
          {% endif %}


        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</form>
{% endblock %}
